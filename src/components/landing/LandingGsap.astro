<script>
  import { gsap } from 'gsap';
  import { ScrollSmoother } from 'gsap/ScrollSmoother';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  import { SplitText } from 'gsap/SplitText';

  gsap.registerPlugin(ScrollTrigger, ScrollSmoother, SplitText);

  ////////////////////////////
  // BOOTSTRAP              //
  ////////////////////////////

  // Bind ScrollSmoother
  ScrollSmoother.create({
    smooth: 1,
    effects: true,
    smoothTouch: 0.01,
  });

  // Register Timelines
  const heroTimeline = gsap.timeline({ paused: true });
  const resumeTimeline = registerBoxTimeline('gsapBoxResume');
  const aboutTimeline = registerBoxTimeline('gsapBoxAbout');
  const skillsTimeline = registerBoxTimeline('gsapBoxSkills');
  const experienceTimeline = registerBoxTimeline('gsapBoxExperience');
  const projectsTimeline = registerBoxTimeline('gsapBoxProjects');
  const contactTimeline = registerBoxTimeline('gsapBoxContact');

  // Store reference to the static background div and ensure it has got the correct base color
  const background = document.querySelector('#landing-background');
  gsap.set(background, {
    backgroundColor: 'rgb(240, 171, 252)', // Tailwind's bg-fuchsia-300
  });

  ////////////////////////////
  // FIRST BOX (HERO)       //
  ////////////////////////////

  // Create SplitText Objects for Hero Text
  SplitText.create('#hero-title', {
    type: 'chars',
    autoSplit: true,
    smartWrap: true,
    aria: 'auto',
    onSplit: (self) => {
      // Set invisible container to be visible
      gsap.set('#hero-title', { autoAlpha: 1 });

      // Execute title animation
      gsap.from(self.chars, {
        x: 50,
        opacity: 0,
        duration: 1,
        ease: 'power1.inOut',
        stagger: 0.04,
      });

      // Execute the remainder of hero timeline
      heroTimeline.play();
    },
  });

  // Add hero subtitle and navigation links to the timeline
  heroTimeline
    .fromTo(
      '#hero-subtitle',
      { y: 15 },
      {
        y: 0,
        autoAlpha: 1,
        duration: 1,
        ease: 'power1.inOut',
        delay: 0.75,
      }
    )
    .fromTo(
      '#hero-links',
      { y: 15 },
      {
        y: 0,
        autoAlpha: 1,
        duration: 1,
        ease: 'power1.inOut',
        delay: -0.75,
      }
    );

  aboutTimeline.addLabel('startAboutTimeline').to(
    background,
    {
      backgroundColor: 'rgb(255, 0, 0)',
      duration: 1,
      ease: 'none',
    },
    'startAboutTimeline'
  );

  skillsTimeline.addLabel('startSkillsTimeline').to(
    background,
    {
      backgroundColor: 'rgb(0, 0, 255)',
      duration: 1,
      ease: 'none',
    },
    'startSkillsTimeline'
  );

  function registerBoxTimeline(
    gsapBoxId: string,
    start: string = 'top bottom',
    end: string = 'top top'
  ): GSAPTimeline {
    if (gsapBoxId[0] !== '#') {
      gsapBoxId = '#' + gsapBoxId;
    }

    return gsap.timeline({
      scrollTrigger: {
        trigger: gsapBoxId,
        start: start,
        end: end,
        scrub: true,
        markers: true,
        onEnter: () => console.log(`[${gsapBoxId}] Entered viewport`),
        onLeave: () => console.log(`[${gsapBoxId}] Reached top`),
        onEnterBack: () => console.log(`[${gsapBoxId}] Re-entered from below`),
        onLeaveBack: () => console.log(`[${gsapBoxId}] Left viewport downward`),
      },
    });
  }
</script>
